name: ğŸ›°ï¸ Keep THE13TH Alive + API Health Check

on:
  schedule:
    - cron: "*/10 * * * *"   # every 10 minutes
  workflow_dispatch:          # manual trigger

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸŒ Ping THE13TH root page
        run: |
          echo "ğŸ”„ Pinging THE13TH root at $(date)"
          if curl -fsS https://the13th.onrender.com/ -o /dev/null; then
            echo "âœ… Root responded OK"
          else
            echo "âŒ Root ping failed"
            exit 1
          fi

      - name: ğŸ§  Check /api/plan JSON health
        run: |
          echo "ğŸ” Checking API health at /api/plan..."
          RESPONSE=$(curl -fsS https://the13th.onrender.com/api/plan || true)
          echo "Response: $RESPONSE"
          
          if echo "$RESPONSE" | grep -q '"Free"' && echo "$RESPONSE" | grep -q '"Pro"'; then
            echo "âœ… API JSON structure looks healthy."
          else
            echo "âš ï¸  API may not be responding correctly."
            exit 1
          fi

      - name: âœ… Summary
        if: ${{ success() }}
        run: |
          echo "âœ¨ THE13TH instance is awake and healthy."
